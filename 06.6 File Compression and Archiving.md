# File Compression and Archiving

In Linux, file compression reduces file size by encoding data more efficiently. This is particularly useful for text files, which can often be reduced by 50-75% in size. However, multimedia files (images, videos, audio) are typically already compressed and may see less reduction (sometimes only 10-25%).

- Linux treats nearly everything as a file, making compression tools universally applicable
- Compression can significantly reduce storage requirements and transfer times
- Different tools offer varying compression ratios and speeds

**Compression Tools**

### 1. gzip (GNU Zip)
**Algorithm:** LZ77 (DEFLATE)  
**Best for:** General-purpose compression with good balance of speed and ratio

**Compression:**
```bash
gzip filename           # Compresses file, creates filename.gz, removes original
gzip -v filename        # Verbose mode (shows compression details)
```

**Decompression:**
```bash
gunzip filename.gz      # Decompresses, removes .gz extension
gzip -d filename.gz     # Alternative method
```

### 2. bzip2
**Algorithm:** Burrows-Wheeler transform with Huffman coding  
**Best for:** Better compression ratios than gzip (slower compression)

**Compression:**
```bash
bzip2 filename          # Compresses file, creates filename.bz2, removes original
bzip2 -v filename       # Verbose mode
```

**Decompression:**
```bash
bunzip2 filename.bz2    # Decompresses, removes .bz2 extension
bzip2 -d filename.bz2   # Alternative method
```

### 3. zip/unzip
**Note:** The zip format is cross-platform, making it ideal for sharing files between Linux and Windows systems.

**Compression:**
```bash
zip archive.zip file1 file2 file3        # Create ZIP archive with multiple files
zip -r archive.zip directory/            # Compress directory recursively
zip -9 archive.zip file                  # Maximum compression (slower)
```

**Decompression:**
```bash
unzip archive.zip                        # Extract all files
unzip archive.zip -d target_directory    # Extract to specific directory
```

## Practical Compression Examples

### Method 1: Compress and Replace Original
This method replaces the original file with its compressed version.

```bash
# Copy example files to current directory
cp /usr/share/dict/words .
cp ~/backup/kdump.conf .

# Compress files (original is removed)
gzip -v words
ls -lh                     # Note: words.gz is created, original words is gone

# Decompress
gunzip words.gz
```

### Method 2: Create Compressed Copy (Preserve Original)
This method keeps the original file and creates a compressed copy.

```bash
# Using gzip
gzip -vc kdump.conf > kdump.conf.gz

# Using bzip2  
bzip2 -vc kdump.conf > kdump.conf.bz2

# Using zip (preserves original by default)
zip kdump.conf.zip kdump.conf
```

## Archiving with tar

**Purpose:** Combine multiple files/directories into a single archive file (tarball). Tar doesn't compress by default but can be combined with compression tools.

### tar Command Options
- `-c` : Create a new archive
- `-v` : Verbose (show files being processed)
- `-f` : Specify archive filename **(must be followed by filename)**
- `-t` : List contents of archive
- `-r` : Append files to existing archive
- `-x` : Extract files from archive
- `-z` : Filter archive through gzip (use .tar.gz or .tgz extension)
- `-j` : Filter archive through bzip2 (use .tar.bz2 or .tbz extension)
- `-C` : Extract to specific directory

### Creating Archives

```bash
# Create uncompressed archive
tar -cvf archive.tar file1 file2 directory/

# Create compressed archives
tar -zcvf archive.tar.gz files/           # gzip compression
tar -jcvf archive.tar.bz2 files/          # bzip2 compression
tar -cvf archive.tar files/ | gzip > archive.tgz  # Alternative syntax
```

### Example Workflow

```bash
# Create backup directory and copy configuration files
mkdir -p ~/backup
cp /etc/*.conf ~/backup/

# Create archive
tar -cvf impfiles.tar /etc/*.conf /var/log /home/david

# List archive contents
tar -tvf impfiles.tar

# Add more files to existing archive (uncompressed only)
tar -rvf impfiles.tar /etc/passwd /etc/hosts
```

## Compressed Archives

Archives are often large, so compressing them saves significant space. There are two approaches:

### Method 1: Archive Then Compress (Two Steps)

```bash
# Create plain archive
tar -cvf impfile.tar /etc/*.conf /var/log

# Compress the archive
gzip -v impfile.tar           # Creates impfile.tar.gz

# Verify size reduction
ls -lh impfile.tar*
```

### Method 2: Archive and Compress Simultaneously (One Step)

```bash
# Using gzip compression
tar -zcvf newimpfile.tar.gz /etc/*.conf /var/log
tar -zcvf newimpfile.tgz /etc/*.conf /var/log    # .tgz is alternative extension

# Using bzip2 compression
tar -jcvf newimpfile.tar.bz2 /etc/*.conf /var/log
tar -jcvf newimpfile.tbz /etc/*.conf /var/log    # .tbz is alternative extension
```

## Important Limitations

### Cannot Update Compressed Archives
```bash
# This will FAIL:
tar -rvf newimpfile.tar.gz /etc/passwd
# Error: "Cannot update compressed archives"

# Solution: Decompress, update, then recompress
gunzip newimpfile.tar.gz                # 1. Decompress
tar -rvf newimpfile.tar /etc/passwd     # 2. Update archive
gzip newimpfile.tar                     # 3. Recompress
```

## Extracting Archives

### Best Practice: Extract to Specific Directory

```bash
# Create extraction directory
mkdir extractdir
cd extractdir

# Extract uncompressed tar archive
tar -xvf ~/newimpfile.tar

# Extract gzip-compressed tar archive
tar -zxvf ~/newimpfile.tar.gz

# Extract bzip2-compressed tar archive  
tar -jxvf ~/newimpfile.tar.bz2

# Alternative: Extract to specific directory without cd
tar -zxvf ~/newimpfile.tar.gz -C /path/to/target/directory
```

## Tool Selection Guide

| Tool | Best For | Compression Ratio | Speed | Cross-Platform |
|------|----------|-------------------|-------|----------------|
| `gzip` | General use, fast compression | Good | Fast | Linux/Unix |
| `bzip2` | Better compression, can wait | Better | Slower | Linux/Unix |
| `zip` | Sharing with Windows users | Good | Moderate | All platforms |
| `tar + gzip` | Linux backups, software distribution | Good | Fast | Primarily Linux/Unix |
| `tar + bzip2` | Archiving where size matters most | Best | Slowest | Primarily Linux/Unix |

## Quick Reference

### Compression
```bash
gzip file                 # Compress with gzip
bzip2 file                # Compress with bzip2  
zip archive.zip file1 file2  # Create ZIP archive
```

### Decompression
```bash
gunzip file.gz            # Decompress gzip
bunzip2 file.bz2          # Decompress bzip2
unzip archive.zip         # Extract ZIP
```

### Archiving
```bash
tar -zcvf archive.tar.gz dir/    # Create compressed archive
tar -zxvf archive.tar.gz         # Extract compressed archive
tar -tvf archive.tar             # List contents
```


1. **Test archives after creation:** Use `tar -tf archive.tar` to verify contents
2. **Preserve permissions:** Use `-p` option with tar to preserve file permissions
3. **Check disk space:** Ensure you have enough space before creating large archives
4. **Use verbose mode:** Especially when learning, to see what's happening
5. **Consider compression level:** With gzip, use `-1` (fastest) to `-9` (best compression)
6. **For cross-platform sharing:** Use `zip` format when working with Windows users
7. **Remove original files carefully:** Most compression tools remove originals by default

---

> Note: The "Everything is a file" philosophy in Linux means these tools can work on various file types, but actual compression effectiveness depends on the content. Text and source code compress well, while already-compressed files (JPEG, MP4, etc.) see minimal reduction.*
